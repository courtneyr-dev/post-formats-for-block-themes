(()=>{"use strict";const t=window.React,e=window.wp.plugins,a=window.wp.components,n=window.wp.data,r=window.wp.element,o=window.wp.i18n,s=window.wp.a11y,i=window.wp.hooks,p=window.wp.blocks,l=()=>{const[e,i]=(0,r.useState)(!1),[l,m]=(0,r.useState)(!1),{isNewPost:c,currentFormat:d,postType:u}=(0,n.useSelect)(t=>{const e=t("core/editor"),a=e.getCurrentPost();return{isNewPost:!a.id||"auto-draft"===a.status,currentFormat:e.getEditedPostAttribute("format")||"standard",postType:a.type}},[]),{editPost:f}=(0,n.useDispatch)("core/editor"),{insertBlocks:b}=(0,n.useDispatch)("core/block-editor");(0,r.useEffect)(()=>{c&&"post"===u&&!l&&window.pfbtData&&setTimeout(()=>{i(!0),m(!0)},500)},[c,u,l]);if(!e||!window.pfbtData)return null;const h=window.pfbtData.formats,g=Object.entries(h).map(([t,e])=>"standard"===t?[t,{...e,name:(0,o.__)("Standard (Single Template)","post-formats-for-block-themes"),description:(0,o.__)("Default post format using the Single template","post-formats-for-block-themes")}]:[t,e]).sort((t,e)=>"standard"===t[0]?-1:"standard"===e[0]?1:t[1].name.localeCompare(e[1].name));return(0,t.createElement)(a.Modal,{title:(0,o.__)("Choose Post Format","post-formats-for-block-themes"),onRequestClose:()=>i(!1),className:"pfpu-format-modal"},(0,t.createElement)("div",{className:"pfpu-format-grid"},g.map(([e,n])=>(0,t.createElement)(a.Card,{key:e,className:"pfpu-format-card"},(0,t.createElement)(a.CardBody,null,(0,t.createElement)(a.Button,{onClick:()=>(t=>{if(f({format:t,template:"standard"===t?"":`single-format-${t}`}),"standard"!==t&&window.pfbtData.formats[t]){const e=window.pfbtData.formats[t];((t,e)=>{if(!window.pfbtData.patterns||!window.pfbtData.patterns[t])return;const a=window.pfbtData.patterns[t],n=(0,p.parse)(a);n.length>0&&e(n,0,void 0,!1)})(t,b),(0,s.speak)(sprintf(/* translators: %s: Format name */ /* translators: %s: Format name */
(0,o.__)("Selected %s format. Pattern inserted.","post-formats-for-block-themes"),e.name),"polite")}i(!1)})(e),className:"pfpu-format-button",variant:"standard"===e?"primary":"secondary"},(0,t.createElement)("span",{className:`dashicons dashicons-${n.icon}`,"aria-hidden":"true"}),(0,t.createElement)("span",{className:"pfpu-format-name"},n.name)),(0,t.createElement)("p",{className:"pfpu-format-description"},n.description))))))},m=()=>{const{createNotice:t,removeNotice:e}=(0,n.useDispatch)("core/notices"),{currentFormat:a,blocks:s}=(0,n.useSelect)(t=>{const e=t("core/editor"),a=t("core/block-editor");return{currentFormat:e.getEditedPostAttribute("format")||"standard",blocks:a.getBlocks()}},[]);return(0,r.useEffect)(()=>{if("status"!==a)return void e("pfbt-status-char-count");const n=s.find(t=>"core/paragraph"===t.name&&t.attributes.className?.includes("status-paragraph"));if(!n)return void e("pfbt-status-char-count");const r=(n.attributes.content||"").replace(/<[^>]*>/g,"").length;r>280?t("error",sprintf(/* translators: %d: Current character count */ /* translators: %d: Current character count */
(0,o.__)("%d / 280 characters - Status updates should be 280 characters or less","post-formats-for-block-themes"),r),{id:"pfbt-status-char-count",isDismissible:!1}):r>=260?t("warning",sprintf(/* translators: %d: Current character count */ /* translators: %d: Current character count */
(0,o.__)("%d / 280 characters - Approaching limit","post-formats-for-block-themes"),r),{id:"pfbt-status-char-count",isDismissible:!1}):e("pfbt-status-char-count")},[a,s,t,e]),null};if((0,e.registerPlugin)("post-formats-for-block-themes",{render:()=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(l,null),(0,t.createElement)(m,null))}),(0,i.addFilter)("editor.BlockEdit","pfpu/status-paragraph-counter",e=>a=>{const{name:n,attributes:r,setAttributes:s}=a;if("core/paragraph"!==n||!r.className?.includes("status-paragraph"))return(0,t.createElement)(e,{...a});const i=280-(r.content||"").replace(/<[^>]*>/g,"").length,p=i<0;return(0,t.createElement)("div",{className:"pfpu-status-paragraph-wrapper"},(0,t.createElement)(e,{...a}),(0,t.createElement)("div",{className:`pfpu-char-counter ${p?"is-over-limit":""} ${i<=20?"is-warning":""}`,"aria-live":"polite","aria-atomic":"true"},(0,t.createElement)("span",null,sprintf(/* translators: %d: Remaining characters */ /* translators: %d: Remaining characters */
(0,o.__)("%d characters remaining","post-formats-for-block-themes"),i))))}),"undefined"!=typeof document){const t=document.createElement("style");t.textContent='\n\t.pfpu-format-modal {\n\t\tmax-width: 800px;\n\t}\n\n\t.pfpu-format-grid {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n\t\tgap: 1rem;\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-format-card {\n\t\ttext-align: center;\n\t}\n\n\t.pfpu-format-button {\n\t\twidth: 100%;\n\t\theight: auto;\n\t\tpadding: 1rem;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tgap: 0.5rem;\n\t}\n\n\t.pfpu-format-button .dashicons {\n\t\tfont-size: 2rem;\n\t\twidth: 2rem;\n\t\theight: 2rem;\n\t}\n\n\t.pfpu-format-name {\n\t\tfont-weight: 600;\n\t}\n\n\t.pfpu-format-description {\n\t\tfont-size: 0.875rem;\n\t\tcolor: #757575;\n\t\tmargin-top: 0.5rem;\n\t}\n\n\t.pfpu-format-change-actions {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 0.5rem;\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-status-validator {\n\t\tmargin-top: 1rem;\n\t}\n\n\t.pfpu-status-paragraph-wrapper {\n\t\tposition: relative;\n\t}\n\n\t.pfpu-char-counter {\n\t\tposition: absolute;\n\t\tbottom: -30px;\n\t\tright: 0;\n\t\tfont-size: 0.875rem;\n\t\tcolor: #757575;\n\t}\n\n\t.pfpu-char-counter.is-warning {\n\t\tcolor: #f0b849;\n\t\tfont-weight: 600;\n\t}\n\n\t.pfpu-char-counter.is-over-limit {\n\t\tcolor: #d63638;\n\t\tfont-weight: 600;\n\t}\n\n\t/* Template Modal - Visual Separation for Format Templates */\n\n\t/* Target template items in the template selection modal */\n\t/* Format templates have "Format" in their title (e.g., "Gallery Format", "Aside Format") */\n\n\t/* Template card styling - targets the button/card elements */\n\t.edit-post-template__panel .components-panel__body button[aria-label*="Format"],\n\t.edit-site-template-card button[aria-label*="Format"],\n\t.block-editor-block-card button[aria-label*="Format"] {\n\t\tborder-left: 4px solid var(--wp-admin-theme-color, #2271b1) !important;\n\t\tpadding-left: 12px !important;\n\t\tbackground: rgba(34, 113, 177, 0.05) !important;\n\t\tposition: relative;\n\t}\n\n\t/* Add emoji badge to format templates */\n\t.edit-post-template__panel .components-panel__body button[aria-label*="Format"]::before,\n\t.edit-site-template-card button[aria-label*="Format"]::before,\n\t.block-editor-block-card button[aria-label*="Format"]::before {\n\t\tcontent: "ðŸŽ¨ ";\n\t\tmargin-right: 4px;\n\t\tfont-size: 14px;\n\t}\n\n\t/* Template dropdown/modal items */\n\t.edit-post-template-dropdown__content button[aria-label*="Format"],\n\t.components-dropdown-menu__menu button[aria-label*="Format"] {\n\t\tborder-left: 4px solid var(--wp-admin-theme-color, #2271b1);\n\t\tpadding-left: 12px;\n\t\tbackground: rgba(34, 113, 177, 0.05);\n\t}\n\n\t/* Add visual indicator to currently selected format template */\n\t.edit-post-template__panel .components-panel__body .is-selected[aria-label*="Format"],\n\tbutton[aria-checked="true"][aria-label*="Format"] {\n\t\tbackground: rgba(34, 113, 177, 0.1) !important;\n\t\tfont-weight: 600;\n\t}\n\n\t/* Template name in sidebar - show when auto-applied */\n\t.edit-post-template__panel .components-panel__body .components-base-control__help {\n\t\tfont-style: italic;\n\t\tcolor: #757575;\n\t}\n',document.head.appendChild(t)}})();